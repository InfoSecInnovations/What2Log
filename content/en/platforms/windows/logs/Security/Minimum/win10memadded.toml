#This is the template for What2Log entries

# Meta data about this w2l entry
title = "Member Added to Group" #Name of the log (i.e. User Logon)
tags = ["Group Activity", "Windows 10", "Windows 7"]

description = """\
Group membership change can indicate a user adding themselves to an \
admin group without permissions. It is important to monitor the groups \
that have escalated permissions. This log is recommended by the NSA Cyber \
Event Forwarding Guidance.
  """

# Additional References Go Here
references = [
"https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/plan/appendix-l--events-to-monitor"
]

[logging]
service = "Microsoft Windows Security auditing" #Service that generates log
channel = "Security" #Log file or channel
event_id = 4732
default_enabled = true #true or false
[logging.scripting]
language = "Powershell" #Language for Log Pile
[logging.scripting.tasks]
view = """Get-WinEvent -FilterHashTable @{LogName='Security';ID='4732'} -MaxEvents 1 | Format-List""" #How to view log
check = 'auditpol /get /subcategory:"security group management"' #How to check if log is enabled
enable = """auditpol /set /subcategory:"security group management" /Success:Enable /Failure:Enable""" #How to enable log
disable = """auditpol /set /subcategory:"security group management" /Success:Disable /Failure:Disable""" #How to disable log

# Compliance & framework information
# Format is level and reference under the header [compliance.name]
# Only include relevant frameworks
[compliance.HIPAA]
level = "Recommended" # Compliance requirement
reference = "https://www.hhs.gov/sites/default/files/ocr/privacy/hipaa/administrative/combined/hipaa-simplification-201303.pdf?language=es" # Reference for compliance
[compliance."NSA Event Forwarding"]
level = "Recommended"
reference = "https://github.com/nsacyber/Event-Forwarding-Guidance/tree/master/Events"
# repeat as needed

[[content]]
img = "/GroupMemChange/WEV1.png"
txt = "Windows 10 Professional logs group membership changes by default. To view this log, navigate to the Event Viewer security tab. To view the group membership change logs, sort or filter by the IDs **4732**. Event ID 4732 is a log of a user being added to a security group."

[[content]]
img = "/GroupMemChange/CLI1-gwe.png"
txt = """To view this log in the command line with Get-WinEvent, open PowerShell as an administrator. From here, enter the command ```Get-WinEvent -FilterHashTable @{LogName='Security';ID='4732'} -MaxEvents 1 | Format-List```"""

[[content]]
img = "/GroupMemChange/CLI1-wevt.png"
txt = 'To view this log in the command line with wevtutil, open PowerShell or Command Prompt as an administrator. From here, enter the command ```wevtutil qe Security "/q:*[System [(EventID=4732)]]"```'
# repeat as needed
